services:
  tokenhub:
    build: .
    ports:
      - "8080:8080"
    environment:
      - TOKENHUB_LISTEN_ADDR=:8080
      - TOKENHUB_DB_DSN=file:/data/tokenhub.sqlite?_pragma=busy_timeout(5000)&_pragma=journal_mode(WAL)
      - TOKENHUB_VAULT_ENABLED=true
      - TOKENHUB_OPENAI_API_KEY=${TOKENHUB_OPENAI_API_KEY}
      - TOKENHUB_ANTHROPIC_API_KEY=${TOKENHUB_ANTHROPIC_API_KEY}
      - TOKENHUB_VLLM_ENDPOINTS=http://vllm-1:8000
      - TOKENHUB_TEMPORAL_ENABLED=${TOKENHUB_TEMPORAL_ENABLED:-false}
      - TOKENHUB_TEMPORAL_HOST=temporal:7233
      - TOKENHUB_TEMPORAL_NAMESPACE=${TOKENHUB_TEMPORAL_NAMESPACE:-tokenhub}
      - TOKENHUB_TEMPORAL_TASK_QUEUE=${TOKENHUB_TEMPORAL_TASK_QUEUE:-tokenhub-tasks}
    volumes:
      - tokenhub_data:/data
    depends_on:
      - vllm-1
      - temporal

  temporal:
    image: temporalio/auto-setup:latest
    ports:
      - "7233:7233"
    environment:
      - DB=sqlite
    volumes:
      - temporal_data:/etc/temporal/data

  temporal-ui:
    image: temporalio/ui:latest
    ports:
      - "8233:8080"
    environment:
      - TEMPORAL_ADDRESS=temporal:7233
    depends_on:
      - temporal

  # Minimal vLLM placeholders (replace with your actual vLLM deployments)
  vllm-1:
    image: nginx:alpine
    ports:
      - "8000:80"

volumes:
  tokenhub_data:
  temporal_data:
