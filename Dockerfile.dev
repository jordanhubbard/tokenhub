# Development/builder image for TokenHub.
# Contains all tools needed for build, test, lint, and docs.
# Used by Makefile targets â€” no host Go/tools required.

FROM golang:1.24-alpine

ARG TARGETARCH
RUN apk add --no-cache git ca-certificates curl bash && \
    MDBOOK_VERSION=0.4.44 && \
    case "${TARGETARCH}" in \
      amd64) MDBOOK_ARCH="x86_64-unknown-linux-musl" ;; \
      arm64) MDBOOK_ARCH="aarch64-unknown-linux-musl" ;; \
      *) echo "unsupported arch: ${TARGETARCH}" && exit 1 ;; \
    esac && \
    curl -sSL --retry 3 --retry-delay 5 "https://github.com/rust-lang/mdBook/releases/download/v${MDBOOK_VERSION}/mdbook-v${MDBOOK_VERSION}-${MDBOOK_ARCH}.tar.gz" \
      -o /tmp/mdbook.tar.gz && tar xz -C /usr/local/bin -f /tmp/mdbook.tar.gz && rm /tmp/mdbook.tar.gz && \
    curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/HEAD/install.sh | sh -s -- -b /usr/local/bin

WORKDIR /src
